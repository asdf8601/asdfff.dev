---
import BaseLayout from "../layouts/BaseLayout.astro"

const posts = await Astro.glob("./posts/*.mdx")

const isDev = import.meta.env.DEV

const sortedPosts = posts
  .filter(post => isDev || !post.frontmatter.draft)
  .sort((a, b) => {
    const dateA = new Date(a.frontmatter.date || 0)
    const dateB = new Date(b.frontmatter.date || 0)
    return dateB.getTime() - dateA.getTime()
  })
  .slice(0, 10)

function formatDate(dateStr: string): string {
  const date = new Date(dateStr)
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  })
}
---

<BaseLayout title="Write the Fucking Manual">
  <article>
    <h1>wtfm</h1>

    <p>Documentation is the bridge between your code and those who need to use it.</p>

    <p>Yet we skip it. We assume it's obvious. We believe "the code is self-documenting."</p>

    <p>It's not.</p>

    {
      sortedPosts.length > 0 && (
        <section class="recent-posts">
          <h2>recent posts</h2>
          <div class="post-list">
            {sortedPosts.map(post => (
              <div class="post-entry">
                <h3>
                  <a href={post.url}>{post.frontmatter.title}</a>
                </h3>
                <time>{formatDate(post.frontmatter.date)}</time>
                {post.frontmatter.description && <p>{post.frontmatter.description}</p>}
              </div>
            ))}
          </div>
          <a href="/posts/" class="read-more">
            read more â†’
          </a>
        </section>
      )
    }
  </article>
</BaseLayout>

<style>
  h1 {
    margin-bottom: var(--spacing-md);
    text-transform: lowercase;
  }

  h2 {
    text-transform: lowercase;
    text-align: center;
    margin-top: calc(var(--spacing-xl) * 0.75);
    margin-bottom: var(--spacing-lg);
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--color-text);
  }

  strong {
    color: var(--color-accent);
    font-weight: 700;
  }

  .recent-posts {
    margin-top: var(--spacing-sm);
    padding-top: var(--spacing-sm);
    border-top: 1px solid var(--color-border);
  }

  .post-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
  }

  .post-entry {
    padding-bottom: var(--spacing-sm);
  }

  .post-entry h3 {
    margin: 0 0 var(--spacing-xs) 0;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .post-entry h3 a {
    text-decoration: none;
  }

  .post-entry h3 a:hover {
    text-decoration: underline;
  }

  .post-entry time {
    display: block;
    color: var(--color-text-muted);
    font-size: 0.85rem;
    margin-bottom: var(--spacing-xs);
  }

  .post-entry p {
    margin: 0;
    color: var(--color-text);
    font-size: 0.95rem;
  }

  .read-more {
    display: inline-block;
    color: var(--color-accent);
    text-decoration: none;
    font-weight: 600;
  }

  .read-more:hover {
    text-decoration: underline;
  }
</style>
